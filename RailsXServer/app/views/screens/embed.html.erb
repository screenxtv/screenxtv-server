<meta encoding='utf-8'>
<%= javascript_include_tag "screen" %>
<%= render partial:'/analytics' %>
<script>
channelID="<%= @url %>"
host=location.hostname;
port=<%= NODE_PORT %>
var terminalview;
$(function(){
	if(!channelID)return;
	terminalview=new TerminalView(document.getElementById("terminal"),host,port,channelID,true);
	window.onresize=function(){terminalview.resize(innerWidth,innerHeight)}
	window.onresize();

  terminalview.onInit=function(data){
    if(!data.vt100){
      $("#terminal").text('OFF AIR');
      window.onresize();
    }
    if(data.casting)terminalview.onCastStart();
    else terminalview.onCastEnd();
  }
  terminalview.onCastStart=function(data){
    $("#terminal").css({opacity:1})
  }
  terminalview.onCastEnd=function(){
    $("#terminal").css({opacity:0.5})
  }
  terminalview.onClose=function(){
    console.log('closed');
    setTimeout(function(){console.log('restart');
      terminalview=new TerminalView(document.getElementById("terminal"),host,port,channelID,true)
    },10*1000);
  }
})

</script>
<a href="/<%= @url %>" target='_top' style='text-decoration:none'>
  <div id="terminal" style="font-size:16px;box-shadow:0 0 8px silver;margin:10px;"></div>
</a>
